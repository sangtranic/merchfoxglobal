<?php use Carbon\Carbon; ?>
@extends('layouts.app')
@section('title', 'Danh sách sản phẩm')
@section('content')
    <div class="content-wrapper">
        <div class="content-header">
            <div class="container">
                <div class="row mb-2">
                    <div class="col-sm-12">
                        <h1 class="m-0"> Thống kê đơn hàng <?php echo (count($listOrder))?></h1>
                    </div><!-- /.col -->

                </div><!-- /.row -->
            </div><!-- /.container-fluid -->
        </div>
        <section class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <!-- LINE CHART -->
                        <div class="card card-info">
                            <div class="card-header">
                                <h3 class="card-title">Đơn T-Shirt</h3>
                                <div class="btn-group">
                                    <button type="button" class="btn btn-tool dropdown-toggle" data-toggle="dropdown" data-offset="-52" aria-expanded="false">
                                        chọn user
                                        <i class="fas fa-bars"></i>
                                    </button>
                                    <ul class="dropdown-menu checkbox-menu" role="menu">
                                        <li class="dropdown-item">
                                            <label>
                                                <input type="checkbox" class="chartCheckBox" value="0"> Tổng
                                            </label>
                                        </li>
                                        @foreach($listUser as $user)
                                            <li class="dropdown-item">
                                                <label>
                                                    <input type="checkbox" class="chartCheckBox" value="{{ $user->id }}">{{ $user->userName }}
                                                </label>
                                            </li>
                                        @endforeach
                                    </ul>
                                </div>
                                <div class="card-tools">

                                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">

                                <div class="chart">
                                    <div class="card-body table-responsive">
                                        <canvas id="myChartCustom" style="width: 100%; min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                                    </div>
                                </div>
                            </div>
                            <!-- /.card-body -->
                        </div>
                        <!-- /.card -->
                    </div>
                    <!-- /.col (RIGHT) -->
                </div>
                <!-- /.row -->
            </div><!-- /.container-fluid -->
        </section>
    </div>
    <!-- /.content-wrapper -->

    <!-- Control Sidebar -->
    <aside class="control-sidebar control-sidebar-dark">
        <!-- Control sidebar content goes here -->
    </aside>
@stop


@section('footer')
    <?php
        function addQuotes($item) {
            return "'" . $item . "'";
        }
        $arrUser = $listUser->pluck('userName')->toArray();;
//        if (isset($listOrder) && count($listOrder) > 0) {
//            $arrUser = array_unique(array_column($listOrder, 'userName'));
//        }
    ?>

    <!-- ChartJS -->
    <script src="/plugins/chart.js/Chart.min.js"></script>
    <!-- AdminLTE App -->
    <script src="/dist/js/adminlte.min.js"></script>
    <!-- AdminLTE for demo purposes -->
    <script src="/dist/js/demo.js"></script>
    <script>
        $(".checkbox-menu").on("change", "input[type='checkbox']", function () {
            $(this).closest("li").toggleClass("active", this.checked);
            const cb = $('.chartCheckBox')
            let val = []
            cb.each((i,v)=>{
                if(v.checked){
                    val.push(i)
                }
            })
            const newDataset = []
            for(const value of val){
                newDataset.push(datasetCustom[value])
            }
            myChartCustom.data.datasets = newDataset
            myChartCustom.update();
        });

        $(document).on("click", ".allow-focus", function (e) {
            e.stopPropagation();
        });
        const ctxCustom = document.getElementById("myChartCustom");
        var phpVars = [<?php echo implode(', ', array_map('addQuotes',$arrUser ));?>];
        const DATA_COUNT = 12;
        const labels = [];
        // for (let i = 0; i < DATA_COUNT; ++i) {
        //     labels.push(i.toString());
        // }

        const datasetCustom = [
            {
                label: 'Tổng',
                data: [],
                fill: false,
                borderColor: 'rgb(255, 99, 132)'
            }
        ];
        for (let i = 0; i < phpVars.length; i++) {
            var dataset = {
                label: phpVars[i],
                data: [],
                fill: false,
                borderColor: '#'+Math.random().toString(16).substr(-6)
            }
            datasetCustom.push(dataset)
        }
        const data = {
            labels: labels,
            datasets: datasetCustom,
        };
        const config = {
            type: "line",
            data: data,
            options: {
                responsive: false,
                legend: {
                    display: false
                },
                title: {
                    display: true,
                    text: "Đơn hàng",
                },
                interaction: {
                    intersect: false,
                },
                // scales: {
                //     x: {
                //         display: true,
                //         title: {
                //             display: true,
                //         },
                //     },
                //     y: {
                //         display: true,
                //         title: {
                //             display: true,
                //             text: "Value",
                //         },
                //         suggestedMin: -10,
                //         suggestedMax: 10,
                //     },
                // },
            },
        };
        const myChartCustom = new Chart(ctxCustom, config);
        var response = {"dataTotal":"[" +
                <?php
                    $dateTo = Carbon::now();
                    for ($index=30; $index>0;$index--)
                {?>

                <?php } ?>
                "{\"date\":\"2023-01-18\",\"value\":125}," +
                "{\"date\":\"2023-01-19\",\"value\":97}," +
                "{\"date\":\"2023-01-20\",\"value\":159}," +
                "{\"date\":\"2023-01-21\",\"value\":131}," +
                "{\"date\":\"2023-01-22\",\"value\":160}," +
                "{\"date\":\"2023-01-23\",\"value\":171}," +
                "{\"date\":\"2023-01-24\",\"value\":206}," +
                "{\"date\":\"2023-01-25\",\"value\":100}," +
                "{\"date\":\"2023-01-26\",\"value\":172}," +
                "{\"date\":\"2023-01-27\",\"value\":146}," +
                "{\"date\":\"2023-01-28\",\"value\":149}," +
                "{\"date\":\"2023-01-29\",\"value\":131}," +
                "{\"date\":\"2023-01-30\",\"value\":275}," +
                "{\"date\":\"2023-01-31\",\"value\":234}," +
                "{\"date\":\"2023-02-01\",\"value\":182}," +
                "{\"date\":\"2023-02-02\",\"value\":215}," +
                "{\"date\":\"2023-02-03\",\"value\":218}," +
                "{\"date\":\"2023-02-04\",\"value\":205}," +
                "{\"date\":\"2023-02-05\",\"value\":180}," +
                "{\"date\":\"2023-02-06\",\"value\":258}," +
                "{\"date\":\"2023-02-07\",\"value\":207}," +
                "{\"date\":\"2023-02-08\",\"value\":184}," +
                "{\"date\":\"2023-02-09\",\"value\":168}," +
                "{\"date\":\"2023-02-10\",\"value\":173}," +
                "{\"date\":\"2023-02-11\",\"value\":155}," +
                "{\"date\":\"2023-02-12\",\"value\":114}," +
                "{\"date\":\"2023-02-13\",\"value\":245}," +
                "{\"date\":\"2023-02-14\",\"value\":164}," +
                "{\"date\":\"2023-02-15\",\"value\":164}," +
                "{\"date\":\"2023-02-16\",\"value\":176}," +
                "{\"date\":\"2023-02-17\",\"value\":0}]",
            "dataItem":[{"date":"2023-01-18","value":125},
                {"date":"2023-01-19","value":97},
                {"date":"2023-01-20","value":159},
                {"date":"2023-01-21","value":131},
                {"date":"2023-01-22","value":160},
                {"date":"2023-01-23","value":171},
                {"date":"2023-01-24","value":206},
                {"date":"2023-01-25","value":100},
                {"date":"2023-01-26","value":172},
                {"date":"2023-01-27","value":146},
                {"date":"2023-01-28","value":149},
                {"date":"2023-01-29","value":131},
                {"date":"2023-01-30","value":275},
                {"date":"2023-01-31","value":234},
                {"date":"2023-02-01","value":182},
                {"date":"2023-02-02","value":215},
                {"date":"2023-02-03","value":218},
                {"date":"2023-02-04","value":205},
                {"date":"2023-02-05","value":180},
                {"date":"2023-02-06","value":258},
                {"date":"2023-02-07","value":207},
                {"date":"2023-02-08","value":184},
                {"date":"2023-02-09","value":168},
                {"date":"2023-02-10","value":173},
                {"date":"2023-02-11","value":155},
                {"date":"2023-02-12","value":114},
                {"date":"2023-02-13","value":245},
                {"date":"2023-02-14","value":164},
                {"date":"2023-02-15","value":164},
                {"date":"2023-02-16","value":176},
                "date":"2023-02-17","value":0}],
        "arrX":["2023-01-18","2023-01-19","2023-01-20","2023-01-21","2023-01-22","2023-01-23",
            "2023-01-24","2023-01-25","2023-01-26","2023-01-27","2023-01-28","2023-01-29",
            "2023-01-30","2023-01-31","2023-02-01","2023-02-02","2023-02-03","2023-02-04",
            "2023-02-05","2023-02-06","2023-02-07","2023-02-08","2023-02-09","2023-02-10",
            "2023-02-11","2023-02-12","2023-02-13","2023-02-14","2023-02-15","2023-02-16","2023-02-17"],
            "arrY":[125,97,159,131,160,171,206,100,172,146,149,131,275,234,182,215,218,205,180,258,207,184,168,173,155,114,245,164,164,176,0],
            "arrUserX":[
                ["2023-01-18","2023-01-19","2023-01-20","2023-01-21","2023-01-22","2023-01-23","2023-01-24","2023-01-25","2023-01-26","2023-01-27","2023-01-28","2023-01-29","2023-01-30","2023-01-31","2023-02-01","2023-02-02","2023-02-03","2023-02-04","2023-02-05","2023-02-06","2023-02-07","2023-02-08","2023-02-09","2023-02-10","2023-02-11","2023-02-12","2023-02-13","2023-02-14","2023-02-15","2023-02-16","2023-02-17"],
            ["2023-01-18","2023-01-19","2023-01-20","2023-01-21","2023-01-22","2023-01-23","2023-01-24","2023-01-25","2023-01-26","2023-01-27","2023-01-28","2023-01-29","2023-01-30","2023-01-31","2023-02-01","2023-02-02","2023-02-03","2023-02-04","2023-02-05","2023-02-06","2023-02-07","2023-02-08","2023-02-09","2023-02-10","2023-02-11","2023-02-12","2023-02-13","2023-02-14","2023-02-15","2023-02-16","2023-02-17"],
            ["2023-01-18","2023-01-19","2023-01-20","2023-01-21","2023-01-22","2023-01-23","2023-01-24","2023-01-25","2023-01-26","2023-01-27","2023-01-28","2023-01-29","2023-01-30","2023-01-31","2023-02-01","2023-02-02","2023-02-03","2023-02-04","2023-02-05","2023-02-06","2023-02-07","2023-02-08","2023-02-09","2023-02-10","2023-02-11","2023-02-12","2023-02-13","2023-02-14","2023-02-15","2023-02-16","2023-02-17"],
            ["2023-01-18","2023-01-19","2023-01-20","2023-01-21","2023-01-22","2023-01-23","2023-01-24","2023-01-25","2023-01-26","2023-01-27","2023-01-28","2023-01-29","2023-01-30","2023-01-31","2023-02-01","2023-02-02","2023-02-03","2023-02-04","2023-02-05","2023-02-06","2023-02-07","2023-02-08","2023-02-09","2023-02-10","2023-02-11","2023-02-12","2023-02-13","2023-02-14","2023-02-15","2023-02-16","2023-02-17"],
            ["2023-01-18","2023-01-19","2023-01-20","2023-01-21","2023-01-22","2023-01-23","2023-01-24","2023-01-25","2023-01-26","2023-01-27","2023-01-28","2023-01-29","2023-01-30","2023-01-31","2023-02-01","2023-02-02","2023-02-03","2023-02-04","2023-02-05","2023-02-06","2023-02-07","2023-02-08","2023-02-09","2023-02-10","2023-02-11","2023-02-12","2023-02-13","2023-02-14","2023-02-15","2023-02-16","2023-02-17"],
            ["2023-01-18","2023-01-19","2023-01-20","2023-01-21","2023-01-22","2023-01-23","2023-01-24","2023-01-25","2023-01-26","2023-01-27","2023-01-28","2023-01-29","2023-01-30","2023-01-31","2023-02-01","2023-02-02","2023-02-03","2023-02-04","2023-02-05","2023-02-06","2023-02-07","2023-02-08","2023-02-09","2023-02-10","2023-02-11","2023-02-12","2023-02-13","2023-02-14","2023-02-15","2023-02-16","2023-02-17"],
            ["2023-01-18","2023-01-19","2023-01-20","2023-01-21","2023-01-22","2023-01-23","2023-01-24","2023-01-25","2023-01-26","2023-01-27","2023-01-28","2023-01-29","2023-01-30","2023-01-31","2023-02-01","2023-02-02","2023-02-03","2023-02-04","2023-02-05","2023-02-06","2023-02-07","2023-02-08","2023-02-09","2023-02-10","2023-02-11","2023-02-12","2023-02-13","2023-02-14","2023-02-15","2023-02-16","2023-02-17"],
            ["2023-01-18","2023-01-19","2023-01-20","2023-01-21","2023-01-22","2023-01-23","2023-01-24","2023-01-25","2023-01-26","2023-01-27","2023-01-28","2023-01-29","2023-01-30","2023-01-31","2023-02-01","2023-02-02","2023-02-03","2023-02-04","2023-02-05","2023-02-06","2023-02-07","2023-02-08","2023-02-09","2023-02-10","2023-02-11","2023-02-12","2023-02-13","2023-02-14","2023-02-15","2023-02-16","2023-02-17"],
            ["2023-01-18","2023-01-19","2023-01-20","2023-01-21","2023-01-22","2023-01-23","2023-01-24","2023-01-25","2023-01-26","2023-01-27","2023-01-28","2023-01-29","2023-01-30","2023-01-31","2023-02-01","2023-02-02","2023-02-03","2023-02-04","2023-02-05","2023-02-06","2023-02-07","2023-02-08","2023-02-09","2023-02-10","2023-02-11","2023-02-12","2023-02-13","2023-02-14","2023-02-15","2023-02-16","2023-02-17"],
            ["2023-01-18","2023-01-19","2023-01-20","2023-01-21","2023-01-22","2023-01-23","2023-01-24","2023-01-25","2023-01-26","2023-01-27","2023-01-28","2023-01-29","2023-01-30","2023-01-31","2023-02-01","2023-02-02","2023-02-03","2023-02-04","2023-02-05","2023-02-06","2023-02-07","2023-02-08","2023-02-09","2023-02-10","2023-02-11","2023-02-12","2023-02-13","2023-02-14","2023-02-15","2023-02-16","2023-02-17"],
            ["2023-01-18","2023-01-19","2023-01-20","2023-01-21","2023-01-22","2023-01-23","2023-01-24","2023-01-25","2023-01-26","2023-01-27","2023-01-28","2023-01-29","2023-01-30","2023-01-31","2023-02-01","2023-02-02","2023-02-03","2023-02-04","2023-02-05","2023-02-06","2023-02-07","2023-02-08","2023-02-09","2023-02-10","2023-02-11","2023-02-12","2023-02-13","2023-02-14","2023-02-15","2023-02-16","2023-02-17"]],
            "arrUserY":[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [13,20,19,16,28,28,18,16,20,23,22,18,26,22,19,23,42,30,30,32,32,30,26,40,20,40,24,16,20,25,0],
            [3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],
            [9,14,11,21,20,16,13,8,9,14,15,0,43,53,27,33,25,30,34,23,25,20,21,14,19,0,50,31,24,24,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [26,0,55,34,0,29,82,0,55,31,30,0,100,44,54,48,46,48,0,96,52,27,37,36,34,0,78,31,34,39,0],
            [16,0,28,0,30,17,23,14,17,22,16,33,24,30,20,26,22,24,0,41,23,25,24,15,29,0,35,27,31,24,0],
            [58,60,46,60,82,81,70,62,71,56,66,80,82,85,62,85,83,73,116,66,75,82,60,68,53,74,57,59,55,64,0]]};
        var updateChart = function() {

            myChartCustom.data.labels = response.arrX;
            myChartCustom.data.datasets[0].data = response.arrY;
            for (let i = 0; i < response.arrUserY.length; i++) {
                myChartCustom.data.datasets[i+1].data = response.arrUserY[i];
            }
            myChartCustom.update();
        }
        updateChart();
    </script>

@endsection
